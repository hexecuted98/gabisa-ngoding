cmake_minimum_required(VERSION 3.15)
project(gabisa_ngoding_cli VERSION 1.0.0 LANGUAGES CXX)

# ============================================================
# üîß KONFIGURASI DASAR                                        
# ============================================================

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# ============================================================
# ‚öôÔ∏è OPSI BUILD
# ============================================================

option(DEBUG_AKTIF "Aktifkan mode debug (1 = aktif, 0 = nonaktif)" OFF)

if (DEBUG_AKTIF)
    add_compile_definitions(DEBUG_AKTIF=1)
    message(STATUS "üîç Mode Debug Aktif")
else()
    add_compile_definitions(DEBUG_AKTIF=0)
    message(STATUS "üöÄ Mode Rilis (DEBUG_AKTIF=0)")
endif()

# ============================================================
# üß† DETEKSI KOMPILER
# ============================================================

if (CMAKE_CXX_COMPILER_ID MATCHES "Clang")
    message(STATUS "üß© Mendeteksi compiler: Clang")
    add_compile_options(-Wall -Wextra -Wpedantic)
elseif (CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
    message(STATUS "üß© Mendeteksi compiler: GCC")
    add_compile_options(-Wall -Wextra -Wpedantic)
elseif (CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
    message(STATUS "üß© Mendeteksi compiler: MSVC")
    add_compile_options(/W4 /permissive-)
else()
    message(WARNING "‚ö†Ô∏è Compiler tidak dikenal, menggunakan pengaturan default.")
endif()

# ============================================================
# üì¶ NATIVE LIBRARY (Gabisa Ngoding Core)
# ============================================================

add_library(gabisa-ngoding-lib STATIC
    src/runtime/gabisa-ngoding.vm.hpp
    src/runtime/gabisa-ngoding.memory.hpp
    src/lexer/gabisa-ngoding.token.hpp
    src/parser/gabisa-ngoding.parser.hpp
    src/helper/helper.debug.hpp
)

target_include_directories(gabisa-ngoding-lib PUBLIC src)

# ============================================================
# üß∞ EXECUTABLES (CLI tools)
# ============================================================

add_executable(gabisa-ngodingc 
    src/cli/gabisa-ngodingc.cpp
    src/utilitas/gabisa-ngoding.util.hpp
)

add_executable(gabisa-ngoding
    src/cli/gabisa-ngoding.cpp
    src/utilitas/gabisa-ngoding.util.hpp
)

target_link_libraries(gabisa-ngoding gabisa-ngoding-lib)
target_link_libraries(gabisa-ngodingc gabisa-ngoding-lib)

target_include_directories(gabisa-ngodingc PRIVATE src)
target_include_directories(gabisa-ngoding PRIVATE src)

# ============================================================
# üß± KONFIGURASI BUILD TYPE DEFAULT
# ============================================================

if (NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE Release CACHE STRING
        "Build type (Debug, Release, RelWithDebInfo, MinSizeRel)" FORCE)
endif()

# ============================================================
# üèóÔ∏è OPTIMASI RILIS
# ============================================================

if (CMAKE_BUILD_TYPE STREQUAL "Release")
    if (CMAKE_CXX_COMPILER_ID MATCHES "Clang|GNU")
        add_compile_options(-O3 -march=native -DNDEBUG)
    elseif (MSVC)
        add_compile_options(/O2 /DNDEBUG)
    endif()
endif()

# ============================================================
# üì§ INSTALASI
# ============================================================

install(TARGETS gabisa-ngoding gabisa-ngodingc gabisa-ngoding-lib
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
)

install(DIRECTORY src/ DESTINATION include
    FILES_MATCHING PATTERN "*.hpp"
)

# ============================================================
# ‚úÖ RINGKASAN KONFIGURASI
# ============================================================

message(STATUS "")
message(STATUS "===================================================")
message(STATUS "üß© Gabisa-Ngoding Build Configuration:")
message(STATUS "  Versi Proyek       : ${PROJECT_VERSION}")
message(STATUS "  Build Type         : ${CMAKE_BUILD_TYPE}")
message(STATUS "  Compiler           : ${CMAKE_CXX_COMPILER_ID}")
message(STATUS "  Debug Aktif        : ${DEBUG_AKTIF}")
message(STATUS "  Output Executable  : gabisa-ngoding / gabisa-ngodingc")
message(STATUS "  Output Library     : libgabisa-ngoding-lib.a (static)")
message(STATUS "===================================================")
